import p from"path";import{readJSON as u}from"boma";import{isExistAndNotNull as m}from"vanicom";import{PEERS_PATH as d}from"./constants.js";import{getIfaceParams as P}from"./memoryConfig.js";const h=n=>{if(!/^((255|254|252|248|240|224|192|128|0)\.){3}(255|254|252|248|240|224|192|128|0)$/.test(n))return!1;const t=n.split(".").map(Number);let a=!1;for(let o=0;o<t.length;o++)if(t[o]===0)a=!0;else if(a&&t[o]!==0)return!1;return!0},S=n=>{const s=P(n);if(!s.success||!s.data)throw new Error(`Failed to get interface params: ${s.errors}`);const{peers:t,ip:a}=s.data,o=u({filePath:p.resolve(d),parseJSON:!0,createIfNotFound:{}}),i=new Set;for(const e of t){const r=o[e];if(!m(r))continue;const c=r.ip.split(",").map(l=>l.trim().split("/")[0]);for(const l of c){const f=l.trim();f!=="0.0.0.0"&&(i.has(f)&&console.error(`Interface ${n} has a possible conflict of IP: ${f}`),i.add(f))}}return i.add(a),Array.from(i)},w=(n,s)=>{const t=n.map(e=>{const r=e.split(".").map(Number);return r.length!==4||r.some(c=>Number.isNaN(c))?null:r[0]<<24|r[1]<<16|r[2]<<8|r[3]}).filter(e=>e!==null).sort((e,r)=>e-r);if(!t.length)return null;const a=t[0]&-1<<32-s,o=a|-1>>>s,i=new Set(t);for(let e=a+1;e<o;e++)if(!i.has(e))return[e>>>24&255,e>>>16&255,e>>>8&255,e&255].join(".");return null};export{w as getFirstAvailableIP,S as getInterfacePeersIPs,h as isValidSubnetMask};
