import{appendFileSync as l,readdir as u,readFileSync as g,writeFileSync as p}from"fs";const h=async(e,t)=>{const r=`
${t}
`;try{l(e,r,"utf-8")}catch(o){throw console.error(`Error on appendDataToConfig to file: "${e}":`,o),o}},a=(e,t)=>{(!e||!Object.keys(t).length)&&console.log("Incorrect data for formatObjectToConfigSection: ",e,t);let r=`[${e}]
`;return Object.entries(t).forEach(([o,s])=>{r+=`${o} = ${s}
`}),r+=`
`,r},y=e=>{let t="";for(const r in e){if(r.toLowerCase()==="peers"){e[r].forEach(o=>{if(!("PublicKey"in o)||!("PresharedKey"in o)||!("AllowedIPs"in o)){console.log("Incorrect peer in configObject: ",o);return}t+=a("Peer",o)});continue}t+=a(r,e[r])}return t},w=async()=>{const e=await new Promise((t,r)=>{u("/etc/wireguard",(o,s)=>{if(o)r(o);else{const n=[];s.forEach(i=>{i.endsWith(".conf")&&n.push(i.replace(/\.[^.]*$/,""))}),t(n)}})});return Array.isArray(e)?e.length?{success:!0,data:e}:{success:!1,errors:"Seems like WireGuard is not configured yet (no .conf files in /etc/wireguard)"}:(console.error("getAllConfigs error when getting the configs files: ",e),{success:!1,errors:"Error when get configs"})},C=(e,t)=>{const r=`/etc/wireguard/${e}.conf`,s=g(r,"utf8").split(/(?=\[)/g);let n=!1;const i=s.filter(c=>{if(c.startsWith("[Peer]")){const f=c.match(/PublicKey\s*=\s*([^\s]+)/);if(f&&f[1]===t)return n=!0,!1}return!0});return n&&p(r,i.join(""),"utf8"),n};export{h as appendDataToConfig,y as formatConfigToString,a as formatObjectToConfigSection,w as getAllConfigs,C as removePeerFromConfig};
