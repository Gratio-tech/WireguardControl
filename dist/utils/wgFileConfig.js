import{appendFileSync as u,readdir as g,readFileSync as p,writeFileSync as h}from"fs";import{WIREGUARD_DIR as a,resolveWireguardPath as d}from"./constants.js";const C=async(e,t)=>{const r=`
${t}
`;try{u(e,r,"utf-8")}catch(o){throw console.error(`Error on appendDataToConfig to file: "${e}":`,o),o}},l=(e,t)=>{(!e||!Object.keys(t).length)&&console.log("Incorrect data for formatObjectToConfigSection: ",e,t);let r=`[${e}]
`;return Object.entries(t).forEach(([o,s])=>{r+=`${o} = ${s}
`}),r+=`
`,r},P=e=>{let t="";for(const r in e){if(r.toLowerCase()==="peers"){e[r].forEach(o=>{if(!("PublicKey"in o)||!("PresharedKey"in o)||!("AllowedIPs"in o)){console.log("Incorrect peer in configObject: ",o);return}t+=l("Peer",o)});continue}t+=l(r,e[r])}return t},w=async()=>{const e=await new Promise((t,r)=>{g(a,(o,s)=>{if(o)r(o);else{const n=[];s.forEach(i=>{i.endsWith(".conf")&&n.push(i.replace(/\.[^.]*$/,""))}),t(n)}})});return Array.isArray(e)?e.length?{success:!0,data:e}:{success:!1,errors:`Seems like WireGuard is not configured yet (no .conf files in ${a})`}:(console.error("getAllConfigs error when getting the configs files: ",e),{success:!1,errors:"Error when get configs"})},S=(e,t)=>{const r=d(e),s=p(r,"utf8").split(/(?=\[)/g);let n=!1;const i=s.filter(c=>{if(c.startsWith("[Peer]")){const f=c.match(/PublicKey\s*=\s*([^\s]+)/);if(f&&f[1]===t)return n=!0,!1}return!0});return n&&h(r,i.join(""),"utf8"),n};export{C as appendDataToConfig,P as formatConfigToString,l as formatObjectToConfigSection,w as getAllConfigs,S as removePeerFromConfig};
