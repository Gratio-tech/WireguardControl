import u from"@gratio/crypt";import{getFrontendConfig as i,getStatusFromBash as g,executeSingleCommand as r,setWGStatus as a}from"../utils/index.js";const l=u.serverCrypt.encryptMsg,f=async(n,t,o)=>{try{const e=await g();if(!e.success||!e.data){t.status(520).json({success:!1,error:e.error||"Unable to retrieve WireGuard status"});return}const{frontendPasskey:s}=i(),c=l({message:e.data,pass:s});t.status(200).json({success:!0,data:c})}catch(e){console.error("getWGStatus service error: ",e);const s=process.env.NODE_ENV==="production"?"Unable to retrieve WireGuard status":`getWGStatus error: ${e.message}`;t.status(520).json({success:!1,error:s}),o(e)}},G=async(n,t,o)=>{const e=n.query.iface;try{let s=await r("wg");if(s==="")a(!1),console.log("WireGuard is down, attempting restart"),await r("bash",["-c",`wg-quick up ${e}`]);else if(a(!0),console.log("WireGuard is running, attempting to stop"),await r("bash",["-c",`wg-quick down ${e}`]),s=await r("wg"),s==="")a(!1),console.log("WireGuard stopped, attempting restart"),await r("bash",["-c",`wg-quick up ${e}`]);else{t.status(500).json({success:!1,error:"Failed to stop WireGuard"});return}a(!0),console.log("WireGuard successfully restarted"),t.status(200).json({success:!0,data:"WireGuard restarted successfully"})}catch(s){console.error("rebootWGinterface service error: ",s);const c=process.env.NODE_ENV==="production"?"Error during WireGuard restart":`rebootWGinterface error: ${s.message}`;t.status(520).json({success:!1,error:c}),o(s)}};export{f as getWGStatus,G as rebootWGinterface};
